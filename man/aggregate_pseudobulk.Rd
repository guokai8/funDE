% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aggregate_pseudobulk.R
\name{aggregate_pseudobulk}
\alias{aggregate_pseudobulk}
\title{Aggregate Single-cell Data to Pseudobulk}
\usage{
aggregate_pseudobulk(
  counts,
  metadata = NULL,
  sample_col,
  celltype_col = NULL,
  min_cells = 10,
  min_features = 1000,
  aggregate_by = "sample",
  assay_name = "counts",
  verbose = TRUE
)
}
\arguments{
\item{counts}{A sparse matrix of counts (genes x cells) or SingleCellExperiment object}

\item{metadata}{A data.frame containing cell metadata with rownames matching colnames of counts}

\item{sample_col}{Column name in metadata containing sample IDs}

\item{celltype_col}{Column name in metadata containing cell type annotations (optional)}

\item{min_cells}{Minimum cells required per pseudobulk sample (default: 10)}

\item{min_features}{Minimum features (genes) required per pseudobulk sample (default: 1000)}

\item{aggregate_by}{How to group cells: "sample" (default), "sample_celltype", or custom grouping}

\item{assay_name}{Name of assay to use if input is SingleCellExperiment (default: "counts")}

\item{verbose}{Logical, print progress messages (default: TRUE)}
}
\value{
A list containing:
  \item{counts}{Pseudobulk count matrix (genes x pseudobulk_samples)}
  \item{metadata}{Metadata for pseudobulk samples}
  \item{cell_counts}{Number of cells per pseudobulk sample}
  \item{original_cells}{Number of cells in original data}
  \item{aggregation_method}{Method used for aggregation}
}
\description{
Aggregates single-cell RNA-seq data to pseudobulk samples for differential
expression analysis. This function sums counts across cells within each 
sample and cell type combination, creating pseudobulk profiles suitable
for standard DE analysis tools.
}
\details{
**Aggregation Methods:**

*By Sample:*
- Aggregate all cells from each sample
- Good for detecting sample-level differences
- Ignores cell type heterogeneity

*By Sample and Cell Type:*
- Aggregate cells within each sample-celltype combination
- Enables cell type-specific DE analysis
- Requires cell type annotations
- More granular but requires more cells

*Custom Grouping:*
- User defines grouping variable
- Maximum flexibility
- Column name in metadata specifying groups

**Quality Filters:**
- Pseudobulk samples with < min_cells are removed
- Genes detected in < min_features are filtered
- Helps ensure reliable DE testing

**Biological Considerations:**
- Pseudobulk approximates bulk RNA-seq from the same samples
- Loses single-cell resolution but gains statistical power
- Suitable for detecting overall expression changes
- May miss cell type-specific effects if aggregating across types
}
\examples{
# Basic aggregation by sample
pseudobulk <- aggregate_pseudobulk(
  counts = sc_counts,
  metadata = sc_metadata,
  sample_col = "sample_id",
  aggregate_by = "sample"
)

# Aggregate by sample and cell type
pseudobulk_ct <- aggregate_pseudobulk(
  counts = sc_counts,
  metadata = sc_metadata,
  sample_col = "sample_id",
  celltype_col = "cell_type",
  aggregate_by = "sample_celltype",
  min_cells = 20
)

# Use aggregated data for DE analysis
de_results <- analyze_genes(
  counts = pseudobulk$counts,
  metadata = pseudobulk$metadata,
  design = ~ condition,
  contrast = c("condition", "treated", "control")
)

# With SingleCellExperiment object
if (requireNamespace("SingleCellExperiment", quietly = TRUE)) {
  pseudobulk_sce <- aggregate_pseudobulk(
    counts = sce_object,
    sample_col = "sample_id",
    celltype_col = "cell_type",
    aggregate_by = "sample_celltype"
  )
}

}
\seealso{
\code{\link{analyze_genes}}, \code{\link{analyze_pathways}}
}
